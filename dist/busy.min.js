angular.module("mnBusy",[]),angular.module("mnBusy").factory("busyTrackerFactory",["$timeout","$q",function(a,b){return function(){var c={};return c.delayPromise=null,c.durationPromise=null,c.processingPromise=null,c.reset=function(d){var e=[];angular.forEach(d.promises,function(a){a&&"undefined"!=typeof a.then&&-1===e.indexOf(a)&&e.push(a)}),0!==e.length&&(d.delay&&(c.delayPromise=a(function(){c.delayPromise=null},parseInt(d.delay,10))),d.minDuration&&(c.durationPromise=a(function(){c.durationPromise=null},parseInt(d.minDuration,10)+(d.delay?parseInt(d.delay,10):0))),c.processingPromise=b.all(e).then(function(){d.onReadyFn&&d.onReadyFn(),c.processingPromise=null},function(){c.processingPromise=null}))},c.isBusy=function(){return null===c.delayPromise&&(null!==c.durationPromise||null!==c.processingPromise)},c.isActive=function(){return null!==c.processingPromise},c}}]).directive("busyTracker",["$injector","busyTrackerFactory",function(a,b){var c=function(b){var c={},d="busyDefaults";a.has(d)&&angular.extend(c,a.get(d));var e="busyConfig";b[e]&&a.has(d+b[e])&&angular.extend(c,a.get(d+b[e]));var f="busyReady";return b[f]&&(c.onReadyExp=b[f]),c},d=function(a){var b,c={},d="busyParam";for(b in a)if(-1!==b.indexOf(d)){var e=b.substr(d.length).toLowerCase();c[e]=a[b]}return c};return{restrict:"A",scope:!0,transclude:!0,templateUrl:function(a,b){return c(b).templateUrl},link:function(a,e,f){a.$tracker=b(),a.$config=c(f),a.$params=d(f),a.$watchCollection(f.busyTracker,function(b){angular.isArray(b)||(b=[b]),!a.$tracker.isActive()&&b.length>0&&a.$tracker.reset({promises:b,delay:a.$config.delay,minDuration:a.$config.minDuration,onReadyFn:a.$config.onReadyExp?function(){a.$eval(a.$config.onReadyExp)}:null})},!0)}}}]);